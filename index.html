<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<script>
			(() => {
				let timer;

				document.addEventListener('message', (msg) => {
					console.log('reply recd');
					clearTimeout(timer);
					console.log(msg.data.text, msg.data.text === 'oofmbcbcffcplfkpajnkinijlibhnnmk');
					if (msg.data.text && msg.data.text != 'oofmbcbcffcplfkpajnkinijlibhnnmk') {
						getExtension();
					} else {
						goToSite();
					}
				});

				function sendMessage() {
					console.log('sending message from page');
					var data = { type: 'FROM_PAGE', text: 'Hello from the webpage!' };
					window.postMessage(data, '*');
					timer = setTimeout(() => {
						alert('time elapsed');
						getExtension();
					}, 5000);
				}

				function getExtension() {
					window.location.replace(
						'https://chrome.google.com/webstore/detail/rakuten-get-cash-back-for/chhjbpecpncaggjpdakmflnfcopglcmi'
					);
				}

				function goToSite() {
					window.location.replace('https://www.nike.com');
				}

				document.addEventListener('DOMContentLoaded', sendMessage);
			})();
		</script>
	</body>
</html>
